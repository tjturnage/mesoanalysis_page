<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>SPC Meso loops</title>
    <style>
                body {
            background-color: rgb(240, 240, 240);
        }
            .display-image {
            width: 900px;
            height: 600px;
            background-repeat: no-repeat;
            background-position: 50% 50%;
            background-size: cover;
            object-fit: contain;
            background-color: rgb(250, 250, 250);
        }

        .image {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.05rem;
            border-radius: 5px;
            min-height: 1.8rem;
        }

        .description-highlight {
            color: red;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .slider {
            padding: 1.0em;
            align-self: center;
            align-content: center;
            align-items: center;
        }

        .strong {
            font-weight: bolder;
            font-size: 1.3em
        }

    </style>
</head>
<body>
    <br>
    <div class="container stretch">    
    <!--<button class="favorite styled"
    type="button">Run script</button>
</button>-->
<div class="container">
<div class="justify-content-center text-center">
    <span><b>Sector:&nbsp;&nbsp;&nbsp;&nbsp;</b></span>
    <div class="form-check form-check-inline">
        <input class="form-check-input radio" type="radio" name="mesoSector" id="s16" value="s16">
        <label class="form-check-label" for="greatlakes">NE & GL</label>
    </div>
    <div class="form-check form-check-inline">
        <input class="form-check-input radio" type="radio" name="mesoSector" id="s17" value="s17">
        <label class="form-check-label" for="greatlakes">Mid Atl</label>
    </div>
    <div class="form-check form-check-inline">
        <input class="form-check-input radio" type="radio" name="mesoSector" id="s18" value="s18">
        <label class="form-check-label" for="greatlakes">SE</label>
    </div>
    <div class="form-check form-check-inline">
        <input class="form-check-input radio" type="radio" name="mesoSector" id="s13" value="s13">
        <label class="form-check-label" for="greatlakes">N Plains</label>
    </div>
    <div class="form-check form-check-inline">
        <input class="form-check-input radio" type="radio" name="mesoSector" id="s20" value="s20">
        <label class="form-check-label" for="greatlakes">Midwest</label>
    </div>
    <div class="form-check form-check-inline">
        <input class="form-check-input radio" type="radio" name="mesoSector" id="s14" value="s14">
        <label class="form-check-label" for="greatlakes">C Plains</label>
    </div>
    <div class="form-check form-check-inline">
        <input class="form-check-input radio" type="radio" name="mesoSector" id="s15" value="s15">
        <label class="form-check-label" for="greatlakes">S Plains</label>
    </div>
    <div class="form-check form-check-inline">
        <input class="form-check-input radio" type="radio" name="mesoSector" id="s11" value="s11">
        <label class="form-check-label" for="greatlakes">NW</label>
    </div>
    <div class="form-check form-check-inline">
        <input class="form-check-input radio" type="radio" name="mesoSector" id="s12" value="s12">
        <label class="form-check-label" for="greatlakes">SW</label>
    </div>
</div>
<div class="container slider">
    <div class="justify-content-center text-center">
        <button type="button" class="btn btn-outline-primary btn-sm" id="pmsl">Pressure and Wind</button>
        <button type="button" class="btn btn-outline-primary btn-sm" id="ttd">Temp/Wind/Dwpt</button>
        <button type="button" class="btn btn-outline-primary btn-sm" id="thea">Theta-E Advection</button>
        <button type="button" class="btn btn-outline-primary btn-sm" id="925mb">925mb Analysis</button>
        <button type="button" class="btn btn-outline-primary btn-sm" id="850mb2">850mb Analysis</button>
        <button type="button" class="btn btn-outline-primary btn-sm" id="850mb">850mb Analysis v2</button>
        <button type="button" class="btn btn-outline-primary btn-sm" id="700mb">700mb Analysis</button>
        <button type="button" class="btn btn-outline-primary btn-sm" id="500mb">500mb Analysis</button>
        <button type="button" class="btn btn-outline-primary btn-sm" id="300mb">300mb Analysis</button>
        <button type="button" class="btn btn-outline-primary btn-sm" id="dlcp">Deep Moist Conv</button>
        <button type="button" class="btn btn-outline-info btn-sm" id="mlcp">MLCAPE</button>
        <button type="button" class="btn btn-outline-info btn-sm" id="dcape">DCAPE</button>
        <button type="button" class="btn btn-outline-info btn-sm" id="laps">Mid-Level Lapse Rates</button>
        <button type="button" class="btn btn-outline-info btn-sm" id="lllr">Low-Level Lapse Rates</button>
        <button type="button" class="btn btn-outline-dark btn-sm" id="eshr">Bulk Shear - Effective</button>
        <button type="button" class="btn btn-outline-dark btn-sm" id="effh">SR Helicity - Effective</button>
        <button type="button" class="btn btn-outline-dark btn-sm" id="brns">BRN Shear</button>
        <button type="button" class="btn btn-outline-danger btn-sm" id="scp">Supercell Composite</button>
        <button type="button" class="btn btn-outline-danger btn-sm" id="stpc">Sig Tor (eff)</button>
        <button type="button" class="btn btn-outline-danger btn-sm" id="cbsig">Craven/Brooks SigSvr</button>
        <button type="button" class="btn btn-outline-danger btn-sm" id="lr3c">LR and MLCAPE - 0-3km</button>
        <button type="button" class="btn btn-outline-danger btn-sm" id="3cvr">Sfc Vort / 0-3km MLCAPE</button>
        <button type="button" class="btn btn-outline-danger btn-sm" id="moshe">Modified SHERBE</button>
        
    </div>
</div>

<div class="container-fluid slider">
    <div class="row justify-content-center text-center">
        <div class="col-sm-12"><label for="this_url" class="form-label strong">Move Slider To Adjust Time</label></div>
    </div>
    <div class="row justify-content-center text-center">
        <div class="col-sm-12"><input class="this_url" type="range" class="form-range" id="this_url" name="times"
         min="0" max="10"></div>
</div>
<br>
<div class="container-fluid">
    <div class="d-flex justify-content-center text-center">
        <div class="row fit">
            <img id="display-image" class="img-fluid display-image"
                src="https://www.spc.noaa.gov/exper/mesoanalysis/s16/mlcp/mlcp.gif">
        </div>
    </div>
</div>
</div>

</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
</script>
<script>


const minutesToAdjust = 60;
const millisecondsPerMinute = 60000;
const hours = [-4,-3,-2,-1,0,1,2,3,4,5,6];
var prod = 'mlcp'
var sector = 's16/'
const baseURL = 'https://www.spc.noaa.gov/exper/mesoanalysis/'
const fcstURL = baseURL + 'fcst/'
const input = document.querySelector('.this_url');
var urls = create_urls();
const radios = document.querySelectorAll(".radio");
const buttons = document.querySelectorAll("button");
const images = document.querySelectorAll("div.image");

input.addEventListener('input', getImage);

function changeSector(e){
    reference_id = e.target.id
    sector = reference_id.slice(0, 3) + '/';
    urls = create_urls();
}

function changeProduct(e){
    reference_id = e.target.id
    prod = reference_id;
    urls = create_urls();
}

for (const radio of radios) {
            radio.addEventListener('change', changeSector);
        };

buttons.forEach(btn => {
    btn.addEventListener('click', b => {
        changeProduct(b);
    })
});

images.forEach(image => {
            image.addEventListener('click', c => {
                //document.getElementById('instructions').style.display = 'none';
                changeProduct(c);
            })

        });

        function getDescription(d) {
            for (var i = 0; i < images.length; i++) {
                images[i].classList.remove('description-highlight');
            }

            let reference_id = d.target.id;
            console.log(reference_id)
            let desc = descriptions[reference_id];
            document.getElementById(reference_id).classList.add('description-highlight');
            if (desc === undefined) {
                document.getElementById('describe').innerHTML = 'Product Description Not Available';
            } else {
                document.getElementById('describe').innerHTML = desc;
            }
        }


function refreshImage(imgURL) {
            // create a new timestamp 
            var timestamp = new Date().getTime();
            var queryString = "?t=" + timestamp;
            newSrc = imgURL + queryString;
            return newSrc
        }

function getImage(e) {
    url =  urls[e.target.value]
    //newURL = refreshImage(url);
    document.getElementById('display-image').src = url;
        }


function padTo2Digits(num) {
  return num.toString().padStart(2, '0');
}

// https://www.spc.noaa.gov/exper/mesoanalysis/s16/mlcp/mlcp_22061720.gif
// https://www.spc.noaa.gov/exper/mesoanalysis/fcst/s16/mlcp_01.gif
function image_URL(ds,h){
  if (h > 0){
    let url = fcstURL + sector + prod + '_' + ds.slice(-2) + '.gif';
    return url;
  }
  if (h < 0){
    let url = baseURL + sector + prod + '/' + prod + '_' + ds + '.gif';
    return url;
  }
  if (h === 0){
    let url = baseURL + sector +  prod + '/' + prod + '.gif';
    return url;
  }
  return;
}

function create_urls(){
    let urls = []
    let now = new Date();
    hours.forEach(h => {
      let date = new Date(now.valueOf() + (h * minutesToAdjust * millisecondsPerMinute));
      let date_string = 
      [
        date.getUTCFullYear().toString().slice(-2),
        padTo2Digits(date.getUTCMonth() + 1),
        padTo2Digits(date.getUTCDate()),
        padTo2Digits(date.getUTCHours())
      ].join('');
      let new_url = image_URL(date_string,h);
      urls.push(new_url)

    })
    return urls;
};

</script>
</html>


